<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>12‑Week Health Progress Tracker</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
  <style>
    body{background:#f8fafc}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px}
    .btn{border-radius:10px}
    .tab{border-bottom:2px solid transparent}
    .tab.active{border-color:#0ea5e9;color:#0ea5e9}
    .table th{font-weight:600;color:#64748b;font-size:.85rem}
    .table td, .table th{border-bottom:1px solid #e5e7eb;padding:.5rem .5rem}
  </style>
</head>
<body class="text-gray-900">
  <div id="root" class="max-w-7xl mx-auto p-4 md:p-6"></div>

  <script>
  (function(){
    const { useEffect, useMemo, useState } = React;
    const { createRoot } = ReactDOM;
    const {
      ResponsiveContainer, LineChart, Line, CartesianGrid, XAxis, YAxis, Tooltip, Legend,
      AreaChart, Area, Bar
    } = Recharts;

    const STORAGE_KEY = "health-progress-tracker-v1";

    function fmtDate(d){ return new Date(d).toISOString().slice(0,10); }
    function today(){ return fmtDate(new Date()); }
    function lastNDates(n){
      const out=[]; const now=new Date();
      for(let i=n-1;i>=0;i--){ const d=new Date(now); d.setDate(now.getDate()-i); out.push(fmtDate(d)); }
      return out;
    }
    function avg(nums){ const a=nums.filter(n=>typeof n==='number'); return a.length? a.reduce((x,y)=>x+y,0)/a.length : undefined; }
    function sum(nums){ return nums.filter(n=>typeof n==='number').reduce((x,y)=>x+y,0); }

    const TARGETS = { calories:1900, protein:165, carbs:140, fat:73, fiber:"30–35", water:"90–120", glucose:"≤100", bp:"<130/80", restingHr:"60–70" };

    function App(){
      const [tab,setTab]=useState("dashboard");
      const [entries,setEntries]=useState([]);
      const [form,setForm]=useState({ date: today() });
      const [importErr,setImportErr]=useState(null);

      useEffect(()=>{ try{ const raw=localStorage.getItem(STORAGE_KEY); if(raw) setEntries(JSON.parse(raw)); }catch(e){} },[]);
      useEffect(()=>{ localStorage.setItem(STORAGE_KEY, JSON.stringify(entries)); },[entries]);

      const last30 = useMemo(()=>{
        const cutoff=new Date(); cutoff.setDate(cutoff.getDate()-29);
        return [...entries].filter(e=>new Date(e.date+'T00:00:00')>=cutoff).sort((a,b)=>a.date.localeCompare(b.date));
      },[entries]);

      const weeks = useMemo(()=>{
        const map={};
        entries.forEach(e=>{
          const d=new Date(e.date+'T00:00:00');
          const dow=d.getDay();
          const monday = new Date(d); monday.setDate(d.getDate() + ((dow===0?-6:1)-dow));
          const sunday = new Date(monday); sunday.setDate(monday.getDate()+6);
          const key=fmtDate(monday)+'_'+fmtDate(sunday);
          (map[key]||(map[key]=[])).push(e);
        });
        return map;
      },[entries]);
      const weekKeys = useMemo(()=>Object.keys(weeks).sort(),[weeks]);

      const latestWeight = useMemo(()=>{
        const s=[...entries].sort((a,b)=>b.date.localeCompare(a.date));
        return s.find(e=>typeof e.weight==='number')?.weight;
      },[entries]);

      const [wk,prev] = useMemo(()=>{
        if(!weekKeys.length) return [undefined,undefined];
        const last=weeks[weekKeys[weekKeys.length-1]];
        const prev=weeks[weekKeys[weekKeys.length-2]];
        const calc=(arr)=>arr?{
          weight: avg(arr.map(e=>e.weight)),
          glucose: avg(arr.map(e=>e.glucose)),
          bpSys: avg(arr.map(e=>e.bpSys)),
          bpDia: avg(arr.map(e=>e.bpDia)),
          calories: avg(arr.map(e=>e.calories)),
          protein: avg(arr.map(e=>e.protein)),
          sleep: avg(arr.map(e=>e.sleep)),
          workoutDays: arr.filter(e=>(e.workoutMinutes||0)>0).length,
          workoutMinutes: sum(arr.map(e=>e.workoutMinutes))
        }:undefined;
        return [calc(last), calc(prev)];
      },[weeks,weekKeys]);

      const chartSeries = useMemo(()=>{
        const days=lastNDates(30); const map={}; last30.forEach(e=>map[e.date]=e);
        return days.map(d=>({
          date:d.slice(5),
          weight: map[d]?.weight,
          glucose: map[d]?.glucose,
          calories: map[d]?.calories,
          protein: map[d]?.protein,
          carbs: map[d]?.carbs,
          fat: map[d]?.fat
        }));
      },[last30]);

      function addEntry(){
        if(!form.date) return;
        setEntries(prev=>{
          const filtered=prev.filter(e=>e.date!==form.date);
          return [...filtered, form].sort((a,b)=>a.date.localeCompare(b.date));
        });
        setForm({ date: today() });
        setTab("log");
      }
      function removeEntry(dateStr){ setEntries(prev=>prev.filter(e=>e.date!==dateStr)); }
      function exportJson(){
        const blob=new Blob([JSON.stringify(entries,null,2)],{type:"application/json"});
        const url=URL.createObjectURL(blob); const a=document.createElement('a');
        a.href=url; a.download='progress-tracker-data.json'; a.click(); URL.revokeObjectURL(url);
      }
      function onImport(ev){
        setImportErr(null);
        const f=ev.target.files?.[0]; if(!f) return;
        const r=new FileReader();
        r.onload=()=>{ try{ const j=JSON.parse(String(r.result)); if(!Array.isArray(j)) throw new Error('Invalid file'); setEntries(j); }catch(err){ setImportErr(err.message||'Import failed'); } };
        r.readAsText(f);
      }

      return React.createElement('div', {className:'space-y-4'},
        React.createElement('div', {className:'flex items-center justify-between flex-wrap gap-2'},
          React.createElement('h1',{className:'text-2xl font-semibold'},"12‑Week Health Progress Tracker"),
          React.createElement('div',{className:'flex gap-2 items-center'},
            React.createElement('button',{className:'btn px-3 py-2 border', onClick:exportJson},'Export JSON'),
            React.createElement('input',{type:'file', accept:'application/json', onChange:onImport, className:'border p-2 rounded'})
          )
        ),
        (importErr ? React.createElement('div',{className:'text-sm text-red-600'},'Import error: ', importErr) : null),
        React.createElement('div', {className:'flex gap-4 border-b pb-1'},
          ['dashboard','add','log','targets'].map(k =>
            React.createElement('button',{
              key:k, onClick:()=>setTab(k),
              className:`tab pb-2 -mb-px ${tab===k?'active text-blue-600':'text-gray-600'}`
            }, k[0].toUpperCase()+k.slice(1))
          )
        ),
        tab==='dashboard' && React.createElement('div',{className:'space-y-4'},
          React.createElement('div',{className:'grid gap-4 md:grid-cols-2 lg:grid-cols-4'},
            card('Latest Weight', latestWeight!=null? latestWeight+' lb':'—'),
            card('This Week • Avg Glucose', wk?.glucose!=null? wk.glucose.toFixed(0)+' mg/dL':'—'),
            card('This Week • Avg Calories', wk?.calories!=null? wk.calories.toFixed(0)+' kcal':'—'),
            card('Workout Minutes (wk)', wk?.workoutMinutes!=null? wk.workoutMinutes:'0')
          ),
          React.createElement('div',{className:'grid gap-4 lg:grid-cols-2'},
            chartCard('Weight & Glucose (Last 30 days)',
              React.createElement(ResponsiveContainer,{width:'100%', height:'100%'},
                React.createElement(LineChart,{data:chartSeries, margin:{top:8,right:16,left:0,bottom:0}},
                  React.createElement(CartesianGrid,{strokeDasharray:'3 3'}),
                  React.createElement(XAxis,{dataKey:'date'}),
                  React.createElement(YAxis,{yAxisId:'left'}),
                  React.createElement(YAxis,{yAxisId:'right', orientation:'right'}),
                  React.createElement(Tooltip,null),
                  React.createElement(Legend,null),
                  React.createElement(Line,{yAxisId:'left', type:'monotone', dataKey:'weight', name:'Weight (lb)', dot:false}),
                  React.createElement(Line,{yAxisId:'right', type:'monotone', dataKey:'glucose', name:'Glucose', dot:false})
                )
              )
            ),
            chartCard('Calories & Macros (Last 30 days)',
              React.createElement(ResponsiveContainer,{width:'100%', height:'100%'},
                React.createElement(AreaChart,{data:chartSeries, margin:{top:8,right:16,left:0,bottom:0}},
                  React.createElement(CartesianGrid,{strokeDasharray:'3 3'}),
                  React.createElement(XAxis,{dataKey:'date'}),
                  React.createElement(YAxis,null),
                  React.createElement(Tooltip,null),
                  React.createElement(Legend,null),
                  React.createElement(Area,{type:'monotone', dataKey:'calories', name:'Calories', fill:'#93c5fd', stroke:'#3b82f6', fillOpacity:0.25}),
                  React.createElement(Bar,{dataKey:'protein', name:'Protein (g)', fill:'#60a5fa'}),
                  React.createElement(Bar,{dataKey:'carbs', name:'Carbs (g)', fill:'#93c5fd'}),
                  React.createElement(Bar,{dataKey:'fat', name:'Fat (g)', fill:'#bfdbfe'})
                )
              )
            )
          ),
          React.createElement('div',{className:'grid grid-cols-1 md:grid-cols-3 gap-3'},
            tile('Weight (avg)', wk?.weight!=null? wk.weight.toFixed(1)+' lb':'—', prev && wk && wk.weight!=null && prev.weight!=null ? '('+ (wk.weight - prev.weight).toFixed(1)+' vs last wk)' : ''),
            tile('BP (avg)', (wk?.bpSys!=null? wk.bpSys.toFixed(0):'—') + ' / ' + (wk?.bpDia!=null? wk.bpDia.toFixed(0):'—') + ' mmHg'),
            tile('Workout Days', wk?.workoutDays ?? 0),
            tile('Minutes / Week', wk?.workoutMinutes ?? 0),
            tile('Average Sleep', wk?.sleep!=null? wk.sleep.toFixed(1)+' hrs':'—'),
            tile('Average Protein', wk?.protein!=null? wk.protein.toFixed(0)+' g':'—')
          )
        ),
        tab==='add' && React.createElement('div', {className:'card p-4 space-y-4'},
          React.createElement('div',{className:'grid grid-cols-1 md:grid-cols-4 gap-3'},
            field('Date', input('date','date')),
            field('Weight (lb)', input('weight','number')),
            field('Waist (in)', input('waist','number')),
            React.createElement('div',{className:'grid grid-cols-2 gap-3'},
              field('BP Sys', input('bpSys','number')),
              field('BP Dia', input('bpDia','number'))
            ),
            field('Fasting Glucose (mg/dL)', input('glucose','number')),
            field('Resting HR (bpm)', input('restingHr','number')),
            field('Sleep (hrs)', input('sleep','number')),
            field('Calories (kcal)', input('calories','number')),
            React.createElement('div',{className:'grid grid-cols-3 gap-3'},
              field('Protein (g)', input('protein','number')),
              field('Carbs (g)', input('carbs','number')),
              field('Fat (g)', input('fat','number'))
            ),
            React.createElement('div',{className:'grid grid-cols-2 gap-3'},
              field('Fiber (g)', input('fiber','number')),
              field('Water (oz)', input('water','number'))
            ),
            field('Steps', input('steps','number')),
            React.createElement('div',{className:'grid grid-cols-3 gap-3'},
              field('Workout Type', select('workoutType',['cardio','strength','core','mobility','rest'])),
              field('Workout Minutes', input('workoutMinutes','number')),
              field('Workout Calories', input('workoutCalories','number'))
            ),
            React.createElement('div',{className:'grid grid-cols-2 gap-3'},
              field('RPE (1-10)', input('rpe','number')),
              field('Energy (1-10)', input('energy','number'))
            ),
            React.createElement('div',{className:'col-span-full'},
              React.createElement('label',{className:'block text-sm text-gray-600 mb-1'},'Notes'),
              React.createElement('textarea',{
                className:'w-full border rounded p-2', rows:3,
                value:form.notes||'', onChange:e=>setForm({...form, notes:e.target.value})
              })
            )
          ),
          React.createElement('div',{className:'flex gap-2'},
            React.createElement('button',{className:'btn px-4 py-2 border', onClick:addEntry},'Save Entry'),
            React.createElement('button',{className:'btn px-4 py-2 border', onClick:()=>setForm({ date: today() })},'Clear'),
            React.createElement('button',{className:'btn px-4 py-2 border', onClick:()=>setForm({ date: today(), calories:1900, protein:165, carbs:140, fat:73 })},'Prefill Targets')
          )
        ),
        tab==='log' && React.createElement('div',{className:'card p-4 overflow-x-auto'},
          React.createElement('table',{className:'min-w-full table text-sm'},
            React.createElement('thead',null,
              React.createElement('tr',null,
                ['Date','Wt','Waist','BP','Glucose','Sleep','Cal','P','C','F','Workout','Min','kcal','Notes','Delete'].map(h=>React.createElement('th',{key:h,className:'text-left p-2'},h))
              )
            ),
            React.createElement('tbody',null,
              last30.map(e=>React.createElement('tr',{key:e.date},
                React.createElement('td',{className:'p-2 whitespace-nowrap'}, e.date),
                React.createElement('td',{className:'p-2'}, e.weight??''),
                React.createElement('td',{className:'p-2'}, e.waist??''),
                React.createElement('td',{className:'p-2'}, e.bpSys&&e.bpDia? `${e.bpSys}/${e.bpDia}`:''),
                React.createElement('td',{className:'p-2'}, e.glucose??''),
                React.createElement('td',{className:'p-2'}, e.sleep??''),
                React.createElement('td',{className:'p-2'}, e.calories??''),
                React.createElement('td',{className:'p-2'}, e.protein??''),
                React.createElement('td',{className:'p-2'}, e.carbs??''),
                React.createElement('td',{className:'p-2'}, e.fat??''),
                React.createElement('td',{className:'p-2'}, e.workoutType??''),
                React.createElement('td',{className:'p-2'}, e.workoutMinutes??''),
                React.createElement('td',{className:'p-2'}, e.workoutCalories??''),
                React.createElement('td',{className:'p-2 max-w-xs truncate', title:e.notes}, e.notes||''),
                React.createElement('td',{className:'p-2'},
                  React.createElement('button',{className:'btn px-3 py-1 border text-red-600', onClick:()=>removeEntry(e.date)},'Delete')
                )
              ))
            )
          )
        ),
        tab==='targets' && React.createElement('div',{className:'grid gap-4 md:grid-cols-2 lg:grid-cols-3'},
          cardList('Daily Nutrition Targets',[
            `Calories: ${TARGETS.calories} kcal`,
            `Protein: ${TARGETS.protein} g`,
            `Carbs: ${TARGETS.carbs} g`,
            `Fat: ${TARGETS.fat} g`,
            `Fiber: ${TARGETS.fiber} g`,
            `Water: ${TARGETS.water} oz`
          ]),
          cardList('Vitals Targets',[
            `Fasting Glucose: ${TARGETS.glucose} mg/dL`,
            `Blood Pressure: ${TARGETS.bp} mmHg`,
            `Resting HR: ${TARGETS.restingHr} bpm`
          ]),
          cardList('Tips',[
            'Aim for 4–6 workouts/week; HR ~110–130 bpm for fat-burn days.',
            'Break fast with protein + fiber; time carbs around training.',
            'Log daily at a consistent morning time.'
          ])
        )
      );

      function field(label,control){
        return React.createElement('div',{className:'grid gap-1'},
          React.createElement('label',{className:'text-sm text-gray-600'},label), control
        );
      }
      function input(key,type){
        const val = form[key] ?? (type==='date'? today(): '');
        return React.createElement('input',{
          className:'border rounded p-2', type:type==='number'?'number':(type==='date'?'date':'text'),
          value: val,
          onChange:e=>setForm({...form, [key]: e.target.value? (type==='number'? Number(e.target.value): e.target.value) : undefined})
        });
      }
      function select(key,opts){
        const val = form[key] || '';
        return React.createElement('select',{
          className:'border rounded p-2', value:val,
          onChange:e=>setForm({...form, [key]: e.target.value || undefined})
        }, [React.createElement('option',{key:'', value:''},'select')].concat(opts.map(o=>React.createElement('option',{key:o, value:o},o))));
      }
      function card(title, value){
        return React.createElement('div',{className:'card p-4'},[
          React.createElement('div',{key:'t',className:'text-sm text-gray-600 mb-1'}, title),
          React.createElement('div',{key:'v',className:'text-3xl font-semibold'}, value)
        ]);
      }
      function tile(title, value, small){
        return React.createElement('div',{className:'card p-3'},[
          React.createElement('div',{key:'t',className:'text-sm text-gray-600'}, title),
          React.createElement('div',{key:'v',className:'text-xl font-semibold'}, value),
          small? React.createElement('div',{key:'s',className:'text-xs text-gray-500'}, small): null
        ]);
      }
      function chartCard(title, child){
        return React.createElement('div',{className:'card p-3 h-80'},[
          React.createElement('div',{key:'t',className:'text-sm text-gray-600 mb-1'}, title),
          React.createElement('div',{key:'c',className:'h-72'}, child)
        ]);
      }
      function cardList(title, items){
        return React.createElement('div',{className:'card p-4'},[
          React.createElement('div',{key:'t',className:'text-sm text-gray-600 mb-2'}, title),
          React.createElement('ul',{key:'u',className:'list-disc pl-5 space-y-1 text-sm'},
            items.map((it,i)=>React.createElement('li',{key:i}, it))
          )
        ]);
      }
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  })();
  </script>
</body>
</html>
